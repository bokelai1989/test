{
  "Description": "(SO0136-ma) - MLOps Workload Orchestrator (Multi Account Option). Version v1.5.0",
  "Metadata": {
    "AWS::CloudFormation::Interface": {
      "ParameterGroups": [
        {
          "Label": {
            "default": "MLOps Framework Settings"
          },
          "Parameters": [
            "NotificationEmail",
            "CodeCommitRepoAddress",
            "ExistingS3Bucket",
            "ExistingECRRepo",
            "UseModelRegistry",
            "CreateModelRegistry",
            "AllowDetailedErrorMessage",
            "DelegatedAdminAccount",
            "DevAccountId",
            "DevOrgId",
            "StagingAccountId",
            "StagingOrgId",
            "ProdAccountId",
            "ProdOrgId"
          ]
        }
      ],
      "ParameterLabels": {
        "NotificationEmail": {
          "default": "Notification Email (Required)"
        },
        "CodeCommitRepoAddress": {
          "default": "CodeCommit Repo URL Address (Optional)"
        },
        "ExistingS3Bucket": {
          "default": "Name of an Existing S3 Bucket (Optional)"
        },
        "ExistingECRRepo": {
          "default": "Name of an Existing Amazon ECR repository (Optional)"
        },
        "UseModelRegistry": {
          "default": "Do you want to use SageMaker Model Registry?"
        },
        "CreateModelRegistry": {
          "default": "Do you want the solution to create a SageMaker's model package group?"
        },
        "AllowDetailedErrorMessage": {
          "default": "Do you want to allow detailed error messages in the APIs response?"
        },
        "DelegatedAdminAccount": {
          "default": "Are you using a delegated administrator account (AWS Organizations)?"
        },
        "DevAccountId": {
          "default": "Development Account ID (Required)"
        },
        "DevOrgId": {
          "default": "Development Account Organizational Unit ID (Required)"
        },
        "StagingAccountId": {
          "default": "Staging Account ID (Required)"
        },
        "StagingOrgId": {
          "default": "Staging Account Organizational Unit ID (Required)"
        },
        "ProdAccountId": {
          "default": "Production Account ID (Required)"
        },
        "ProdOrgId": {
          "default": "Production Account Organizational Unit ID (Required)"
        }
      }
    }
  },
  "Parameters": {
    "NotificationEmail": {
      "Type": "String",
      "AllowedPattern": "^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$",
      "ConstraintDescription": "Please enter an email address with correct format (example@example.com)",
      "Description": "email for pipeline outcome notifications",
      "MaxLength": 320,
      "MinLength": 5
    },
    "CodeCommitRepoAddress": {
      "Type": "String",
      "AllowedPattern": "^(((https:\\/\\/|ssh:\\/\\/)(git\\-codecommit)\\.[a-zA-Z0-9_.+-]+(amazonaws\\.com\\/)[a-zA-Z0-9-.]+(\\/)[a-zA-Z0-9-.]+(\\/)[a-zA-Z0-9-.]+$)|^$)",
      "ConstraintDescription": "CodeCommit address must follow the pattern: ssh or https://git-codecommit.REGION.amazonaws.com/version/repos/REPONAME",
      "Description": "AWS CodeCommit repository clone URL to connect to the framework.",
      "MaxLength": 320,
      "MinLength": 0
    },
    "ExistingS3Bucket": {
      "Type": "String",
      "AllowedPattern": "((?=^.{3,63}$)(?!^(\\d+\\.)+\\d+$)(^(([a-z0-9]|[a-z0-9][a-z0-9\\-]*[a-z0-9])\\.)*([a-z0-9]|[a-z0-9][a-z0-9\\-]*[a-z0-9])$)|^$)",
      "Description": "Name of existing S3 bucket to be used for ML assets. S3 Bucket must be in the same region as the deployed stack, and has versioning enabled. If not provided, a new S3 bucket will be created.",
      "MaxLength": 63,
      "MinLength": 0
    },
    "ExistingECRRepo": {
      "Type": "String",
      "AllowedPattern": "((?:[a-z0-9]+(?:[._-][a-z0-9]+)*/)*[a-z0-9]+(?:[._-][a-z0-9]+)*|^$)",
      "Description": "Name of existing Amazon ECR repository for custom algorithms. If not provided, a new ECR repo will be created.",
      "MaxLength": 63,
      "MinLength": 0
    },
    "UseModelRegistry": {
      "Type": "String",
      "Default": "No",
      "AllowedValues": [
        "Yes",
        "No"
      ],
      "Description": "Will Amazon SageMaker's Model Registry be used to provision models?"
    },
    "CreateModelRegistry": {
      "Type": "String",
      "Default": "No",
      "AllowedValues": [
        "Yes",
        "No"
      ],
      "Description": "Do you want the solution to create the SageMaker Model Package Group Name (i.e., Model Registry)"
    },
    "AllowDetailedErrorMessage": {
      "Type": "String",
      "Default": "Yes",
      "AllowedValues": [
        "Yes",
        "No"
      ],
      "Description": "Allow including a detailed message of any server-side errors in the API call's response"
    },
    "DelegatedAdminAccount": {
      "Type": "String",
      "Default": "Yes",
      "AllowedValues": [
        "Yes",
        "No"
      ],
      "Description": "Is a delegated administrator account used to deploy accross account"
    },
    "DevAccountId": {
      "Type": "String",
      "AllowedPattern": "^\\d{12}$",
      "Description": "AWS development account number where the CF template will be deployed"
    },
    "DevOrgId": {
      "Type": "String",
      "AllowedPattern": "^ou-[0-9a-z]{4,32}-[a-z0-9]{8,32}$",
      "Description": "AWS development organizational unit id where the CF template will be deployed"
    },
    "StagingAccountId": {
      "Type": "String",
      "AllowedPattern": "^\\d{12}$",
      "Description": "AWS staging account number where the CF template will be deployed"
    },
    "StagingOrgId": {
      "Type": "String",
      "AllowedPattern": "^ou-[0-9a-z]{4,32}-[a-z0-9]{8,32}$",
      "Description": "AWS staging organizational unit id where the CF template will be deployed"
    },
    "ProdAccountId": {
      "Type": "String",
      "AllowedPattern": "^\\d{12}$",
      "Description": "AWS production account number where the CF template will be deployed"
    },
    "ProdOrgId": {
      "Type": "String",
      "AllowedPattern": "^ou-[0-9a-z]{4,32}-[a-z0-9]{8,32}$",
      "Description": "AWS production organizational unit id where the CF template will be deployed"
    }
  },
  "Conditions": {
    "GitAddressProvided": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "CodeCommitRepoAddress"
            },
            ""
          ]
        }
      ]
    },
    "S3BucketProvided": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "ExistingS3Bucket"
            },
            ""
          ]
        }
      ]
    },
    "ECRProvided": {
      "Fn::Not": [
        {
          "Fn::Equals": [
            {
              "Ref": "ExistingECRRepo"
            },
            ""
          ]
        }
      ]
    },
    "CreateModelRegistryCondition": {
      "Fn::Equals": [
        {
          "Ref": "CreateModelRegistry"
        },
        "Yes"
      ]
    },
    "CreateS3Bucket": {
      "Fn::Equals": [
        {
          "Ref": "ExistingS3Bucket"
        },
        ""
      ]
    },
    "CreateECRRepo": {
      "Fn::Equals": [
        {
          "Ref": "ExistingECRRepo"
        },
        ""
      ]
    },
    "AnonymousDatatoAWS": {
      "Fn::Equals": [
        {
          "Fn::FindInMap": [
            "AnonymousData",
            "SendAnonymousData",
            "Data"
          ]
        },
        "Yes"
      ]
    }
  },
  "Resources": {
    "accessLogs751B1465": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        }
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W35",
              "reason": "This is the access bucket"
            }
          ]
        }
      }
    },
    "accessLogsPolicy8C9988FF": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "accessLogs751B1465"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false"
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "accessLogs751B1465",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "HttpsOnly"
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "accessLogs751B1465"
          },
          "LogFilePrefix": "assets_bucket_access_logs"
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        },
        "VersioningConfiguration": {
          "Status": "Enabled"
        }
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Condition": "CreateS3Bucket"
    },
    "pipelineassets28ca6efdaf6b4620b533d07850906d2dPolicy98F94A22": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false"
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "HttpsOnly"
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": [
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "DevAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "StagingAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "ProdAccountId"
                        },
                        ":root"
                      ]
                    ]
                  }
                ]
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Condition": "CreateS3Bucket"
    },
    "ECRRepoC36DC9E6": {
      "Type": "AWS::ECR::Repository",
      "Properties": {
        "ImageScanningConfiguration": {
          "ScanOnPush": true
        },
        "RepositoryPolicyText": {
          "Statement": [
            {
              "Action": [
                "ecr:DescribeImages",
                "ecr:DescribeRepositories",
                "ecr:GetDownloadUrlForLayer",
                "ecr:BatchGetImage",
                "ecr:BatchCheckLayerAvailability"
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": [
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "DevAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "StagingAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "ProdAccountId"
                        },
                        ":root"
                      ]
                    ]
                  }
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Condition": "CreateECRRepo"
    },
    "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        },
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "accessLogs751B1465"
          },
          "LogFilePrefix": "blueprint-repository-dd714561-948e-4cda-9f5d-f5462a5936bc"
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        }
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain"
    },
    "blueprintrepositorydd714561948e4cda9f5df5462a5936bcPolicy7A92A221": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false"
                }
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*"
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                        "Arn"
                      ]
                    },
                    "/*"
                  ]
                ]
              },
              "Sid": "HttpsOnly"
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Principal": {
                "AWS": [
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "DevAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "StagingAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "ProdAccountId"
                        },
                        ":root"
                      ]
                    ]
                  }
                ]
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "SolutionHelperServiceRoleB95702BC": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ]
      }
    },
    "SolutionHelperC369AAA8": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Sub": "solutions-${AWS::Region}"
          },
          "S3Key": "mlops-workload-orchestrator/v1.5.0/asset82372754a20fde49eea4cbb4dbbf05c73476ed61dda988653e03535bfb7b75ce.zip"
        },
        "Role": {
          "Fn::GetAtt": [
            "SolutionHelperServiceRoleB95702BC",
            "Arn"
          ]
        },
        "Environment": {
          "Variables": {
            "AWS_SDK_USER_AGENT": "{\"user_agent_extra\": \"AwsSolution/SO0136/v1.5.0\"}"
          }
        },
        "Handler": "lambda_function.handler",
        "Runtime": "python3.8",
        "Timeout": 300
      },
      "DependsOn": [
        "SolutionHelperServiceRoleB95702BC"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need to be attached to a vpc."
            },
            {
              "id": "W58",
              "reason": "The lambda functions role already has permissions to write cloudwatch logs"
            },
            {
              "id": "W92",
              "reason": "The lambda function does need to define ReservedConcurrentExecutions"
            }
          ]
        }
      }
    },
    "CreateUniqueID": {
      "Type": "Custom::CreateUUID",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "SolutionHelperC369AAA8",
            "Arn"
          ]
        },
        "Resource": "UUID",
        "CreateModelRegistry": {
          "Ref": "CreateModelRegistry"
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "SageMakerModelRegistry": {
      "Type": "AWS::SageMaker::ModelPackageGroup",
      "Properties": {
        "ModelPackageGroupName": {
          "Fn::Join": [
            "",
            [
              "mlops-model-registry-",
              {
                "Fn::Select": [
                  0,
                  {
                    "Fn::Split": [
                      "-",
                      {
                        "Fn::GetAtt": [
                          "CreateUniqueID",
                          "UUID"
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          ]
        },
        "ModelPackageGroupDescription": "SageMaker model package group name (model registry) for mlops",
        "ModelPackageGroupPolicy": {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "AddPermModelPackageGroup",
              "Effect": "Allow",
              "Principal": {
                "AWS": [
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "DevAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "StagingAccountId"
                        },
                        ":root"
                      ]
                    ]
                  },
                  {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":iam::",
                        {
                          "Ref": "ProdAccountId"
                        },
                        ":root"
                      ]
                    ]
                  }
                ]
              },
              "Action": [
                "sagemaker:DescribeModelPackageGroup",
                "sagemaker:DescribeModelPackage",
                "sagemaker:ListModelPackages",
                "sagemaker:UpdateModelPackage",
                "sagemaker:CreateModel"
              ],
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":sagemaker:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":model-package-group/mlops-model-registry-",
                      {
                        "Fn::Select": [
                          0,
                          {
                            "Fn::Split": [
                              "-",
                              {
                                "Fn::GetAtt": [
                                  "CreateUniqueID",
                                  "UUID"
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":sagemaker:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":model-package/mlops-model-registry-",
                      {
                        "Fn::Select": [
                          0,
                          {
                            "Fn::Split": [
                              "-",
                              {
                                "Fn::GetAtt": [
                                  "CreateUniqueID",
                                  "UUID"
                                ]
                              }
                            ]
                          }
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ]
        },
        "Tags": [
          {
            "Key": "stack-name",
            "Value": {
              "Ref": "AWS::StackName"
            }
          }
        ]
      },
      "DependsOn": [
        "CreateUniqueID"
      ],
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Condition": "CreateModelRegistryCondition"
    },
    "CustomResourceLambdaServiceRole757E6AFA": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ]
      }
    },
    "CustomResourceLambdaServiceRoleDefaultPolicy2AB589DB": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject",
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:s3:::solutions-",
                      {
                        "Ref": "AWS::Region"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:s3:::solutions-",
                      {
                        "Ref": "AWS::Region"
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:DeleteObject*",
                "s3:PutObject*",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "CustomResourceLambdaServiceRoleDefaultPolicy2AB589DB",
        "Roles": [
          {
            "Ref": "CustomResourceLambdaServiceRole757E6AFA"
          }
        ]
      }
    },
    "CustomResourceLambda42C1FE6E": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Sub": "solutions-${AWS::Region}"
          },
          "S3Key": "mlops-workload-orchestrator/v1.5.0/asset4b621ccd87c5bbd389ca2f9a5731a5eef1a60b7c0c17b2fe847170e7f613c055.zip"
        },
        "Role": {
          "Fn::GetAtt": [
            "CustomResourceLambdaServiceRole757E6AFA",
            "Arn"
          ]
        },
        "Environment": {
          "Variables": {
            "SOURCE_BUCKET": {
              "Fn::Join": [
                "",
                [
                  "solutions-",
                  {
                    "Ref": "AWS::Region"
                  }
                ]
              ]
            },
            "FILE_KEY": "mlops-workload-orchestrator/v1.5.0/blueprints.zip",
            "DESTINATION_BUCKET": {
              "Ref": "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C"
            },
            "LOG_LEVEL": "INFO",
            "AWS_SDK_USER_AGENT": "{\"user_agent_extra\": \"AwsSolution/SO0136/v1.5.0\"}"
          }
        },
        "Handler": "index.on_event",
        "MemorySize": 256,
        "Runtime": "python3.8",
        "Timeout": 600
      },
      "DependsOn": [
        "CustomResourceLambdaServiceRoleDefaultPolicy2AB589DB",
        "CustomResourceLambdaServiceRole757E6AFA"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need to be attached to a vpc."
            },
            {
              "id": "W58",
              "reason": "The lambda functions role already has permissions to write cloudwatch logs"
            },
            {
              "id": "W92",
              "reason": "The lambda function does need to define ReservedConcurrentExecutions"
            }
          ]
        }
      }
    },
    "CustomResourceCopyAssets": {
      "Type": "AWS::CloudFormation::CustomResource",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomResourceLambda42C1FE6E",
            "Arn"
          ]
        }
      },
      "DependsOn": [
        "blueprintrepositorydd714561948e4cda9f5df5462a5936bcPolicy7A92A221",
        "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C"
      ],
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete"
    },
    "mlopscloudformationrole867810B0": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "cloudformation.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      }
    },
    "lambdaOrchestratorPolicy1A0EFCB1": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "cloudformation:CreateStack",
                "cloudformation:DeleteStack",
                "cloudformation:UpdateStack",
                "cloudformation:DescribeStacks",
                "cloudformation:ListStackResources"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":cloudformation:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":stack/mlops-pipeline*/*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "iam:CreateRole",
                "iam:DeleteRole",
                "iam:DeleteRolePolicy",
                "iam:GetRole",
                "iam:GetRolePolicy",
                "iam:PassRole",
                "iam:PutRolePolicy",
                "iam:AttachRolePolicy",
                "iam:DetachRolePolicy"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":iam::",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":role/mlops-pipeline*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "ecr:CreateRepository",
                "ecr:DescribeRepositories"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":ecr:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":repository/",
                    {
                      "Fn::If": [
                        "ECRProvided",
                        {
                          "Ref": "ExistingECRRepo"
                        },
                        {
                          "Ref": "ECRRepoC36DC9E6"
                        }
                      ]
                    }
                  ]
                ]
              }
            },
            {
              "Action": [
                "codebuild:CreateProject",
                "codebuild:DeleteProject",
                "codebuild:BatchGetProjects"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":codebuild:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":project/ContainerFactory*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":codebuild:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":project/VerifySagemaker*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":codebuild:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":report-group/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "lambda:CreateFunction",
                "lambda:DeleteFunction",
                "lambda:InvokeFunction",
                "lambda:PublishLayerVersion",
                "lambda:DeleteLayerVersion",
                "lambda:GetLayerVersion",
                "lambda:GetFunctionConfiguration",
                "lambda:GetFunction",
                "lambda:AddPermission",
                "lambda:RemovePermission",
                "lambda:UpdateFunctionConfiguration"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":lambda:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":layer:*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":lambda:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":function:*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:ListBucket"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Fn::If": [
                          "S3BucketProvided",
                          {
                            "Ref": "ExistingS3Bucket"
                          },
                          {
                            "Ref": "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7"
                          }
                        ]
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Fn::If": [
                          "S3BucketProvided",
                          {
                            "Ref": "ExistingS3Bucket"
                          },
                          {
                            "Ref": "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7"
                          }
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "codepipeline:CreatePipeline",
                "codepipeline:UpdatePipeline",
                "codepipeline:DeletePipeline",
                "codepipeline:GetPipeline",
                "codepipeline:GetPipelineState"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":codepipeline:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":mlops-pipeline*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "apigateway:POST",
                "apigateway:PATCH",
                "apigateway:DELETE",
                "apigateway:GET",
                "apigateway:PUT"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":apigateway:",
                      {
                        "Ref": "AWS::Region"
                      },
                      "::/restapis/*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":apigateway:",
                      {
                        "Ref": "AWS::Region"
                      },
                      "::/restapis"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":apigateway:",
                      {
                        "Ref": "AWS::Region"
                      },
                      "::/account"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":apigateway:",
                      {
                        "Ref": "AWS::Region"
                      },
                      "::/usageplans"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":apigateway:",
                      {
                        "Ref": "AWS::Region"
                      },
                      "::/usageplans/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:DescribeLogGroups"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":logs:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":log-group:*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "s3:CreateBucket",
                "s3:PutEncryptionConfiguration",
                "s3:PutBucketVersioning",
                "s3:PutBucketPublicAccessBlock",
                "s3:PutBucketLogging"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":s3:::*"
                  ]
                ]
              }
            },
            {
              "Action": "s3:PutObject",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":s3:::",
                    {
                      "Fn::If": [
                        "S3BucketProvided",
                        {
                          "Ref": "ExistingS3Bucket"
                        },
                        {
                          "Ref": "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7"
                        }
                      ]
                    },
                    "/*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "sns:CreateTopic",
                "sns:DeleteTopic",
                "sns:Subscribe",
                "sns:Unsubscribe",
                "sns:GetTopicAttributes",
                "sns:SetTopicAttributes"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":sns:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":mlops-pipeline*-*PipelineNotification*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "events:PutRule",
                "events:DescribeRule",
                "events:PutTargets",
                "events:RemoveTargets",
                "events:DeleteRule",
                "events:PutEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":events:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":rule/*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":events:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":event-bus/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "lambdaOrchestratorPolicy1A0EFCB1",
        "Roles": [
          {
            "Ref": "mlopscloudformationrole867810B0"
          },
          {
            "Ref": "PipelineOrchestrationLambdaFunctionServiceRoleE64D6F74"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W76",
              "reason": "A complex IAM policy is required for this resource."
            }
          ]
        }
      }
    },
    "sagemakerlayer1589FAB3": {
      "Type": "AWS::Lambda::LayerVersion",
      "Properties": {
        "Content": {
          "S3Bucket": {
            "Ref": "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C"
          },
          "S3Key": "blueprints/byom/lambdas/sagemaker_layer.zip"
        },
        "CompatibleRuntimes": [
          "python3.8"
        ]
      },
      "DependsOn": [
        "CustomResourceCopyAssets"
      ]
    },
    "PipelineOrchestrationLambdaFunctionServiceRoleE64D6F74": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":log-group:/aws/lambda/*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaFunctionServiceRolePolicy"
          }
        ]
      }
    },
    "PipelineOrchestrationLambdaFunctionServiceRoleDefaultPolicy3DDDD50A": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords"
              ],
              "Effect": "Allow",
              "Resource": "*"
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "iam:passrole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "mlopscloudformationrole867810B0",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "PipelineOrchestrationLambdaFunctionServiceRoleDefaultPolicy3DDDD50A",
        "Roles": [
          {
            "Ref": "PipelineOrchestrationLambdaFunctionServiceRoleE64D6F74"
          }
        ]
      },
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W12",
              "reason": "Lambda needs the following minimum required permissions to send trace data to X-Ray and access ENIs in a VPC."
            }
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaFunction7EE5E931": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Fn::Sub": "solutions-${AWS::Region}"
          },
          "S3Key": "mlops-workload-orchestrator/v1.5.0/asset81888ba2737ff01b9c520ba970b908b41f044293b5c40f4790a8c3b704e6dff5.zip"
        },
        "Role": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaFunctionServiceRoleE64D6F74",
            "Arn"
          ]
        },
        "Environment": {
          "Variables": {
            "BLUEPRINT_BUCKET_URL": {
              "Fn::GetAtt": [
                "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C",
                "RegionalDomainName"
              ]
            },
            "BLUEPRINT_BUCKET": {
              "Ref": "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C"
            },
            "ACCESS_BUCKET": {
              "Ref": "accessLogs751B1465"
            },
            "ASSETS_BUCKET": {
              "Fn::If": [
                "S3BucketProvided",
                {
                  "Ref": "ExistingS3Bucket"
                },
                {
                  "Ref": "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7"
                }
              ]
            },
            "CFN_ROLE_ARN": {
              "Fn::GetAtt": [
                "mlopscloudformationrole867810B0",
                "Arn"
              ]
            },
            "PIPELINE_STACK_NAME": "mlops-pipeline",
            "NOTIFICATION_EMAIL": {
              "Ref": "NotificationEmail"
            },
            "REGION": {
              "Ref": "AWS::Region"
            },
            "IS_MULTI_ACCOUNT": "True",
            "USE_MODEL_REGISTRY": {
              "Ref": "UseModelRegistry"
            },
            "ALLOW_DETAILED_ERROR_MESSAGE": {
              "Ref": "AllowDetailedErrorMessage"
            },
            "ECR_REPO_NAME": {
              "Fn::If": [
                "ECRProvided",
                {
                  "Ref": "ExistingECRRepo"
                },
                {
                  "Ref": "ECRRepoC36DC9E6"
                }
              ]
            },
            "ECR_REPO_ARN": {
              "Fn::If": [
                "ECRProvided",
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":ecr:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":repository/",
                      {
                        "Ref": "ExistingECRRepo"
                      }
                    ]
                  ]
                },
                {
                  "Fn::GetAtt": [
                    "ECRRepoC36DC9E6",
                    "Arn"
                  ]
                }
              ]
            },
            "LOG_LEVEL": "DEBUG",
            "IS_DELEGATED_ADMIN": {
              "Ref": "DelegatedAdminAccount"
            },
            "DEV_ACCOUNT_ID": {
              "Ref": "DevAccountId"
            },
            "DEV_ORG_ID": {
              "Ref": "DevOrgId"
            },
            "STAGING_ACCOUNT_ID": {
              "Ref": "StagingAccountId"
            },
            "STAGING_ORG_ID": {
              "Ref": "StagingOrgId"
            },
            "PROD_ACCOUNT_ID": {
              "Ref": "ProdAccountId"
            },
            "PROD_ORG_ID": {
              "Ref": "ProdOrgId"
            },
            "AWS_SDK_USER_AGENT": "{\"user_agent_extra\": \"AwsSolution/SO0136/v1.5.0\"}"
          }
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Ref": "sagemakerlayer1589FAB3"
          }
        ],
        "Runtime": "python3.8",
        "Timeout": 600,
        "TracingConfig": {
          "Mode": "Active"
        }
      },
      "DependsOn": [
        "PipelineOrchestrationLambdaFunctionServiceRoleDefaultPolicy3DDDD50A",
        "PipelineOrchestrationLambdaFunctionServiceRoleE64D6F74"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W89",
              "reason": "The lambda function does not need to be attached to a vpc."
            },
            {
              "id": "W58",
              "reason": "The lambda functions role already has permissions to write cloudwatch logs"
            },
            {
              "id": "W92",
              "reason": "The lambda function does need to define ReservedConcurrentExecutions"
            }
          ]
        }
      }
    },
    "PipelineOrchestrationApiAccessLogGroup1BD28E64": {
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W86",
              "reason": "Retention period for CloudWatchLogs LogGroups are set to 'Never Expire' to preserve customer data indefinitely"
            },
            {
              "id": "W84",
              "reason": "By default CloudWatchLogs LogGroups data is encrypted using the CloudWatch server-side encryption keys (AWS Managed Keys)"
            }
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaRestApi0420670E": {
      "Type": "AWS::ApiGateway::RestApi",
      "Properties": {
        "EndpointConfiguration": {
          "Types": [
            "EDGE"
          ]
        },
        "Name": {
          "Fn::Join": [
            "",
            [
              {
                "Ref": "AWS::StackName"
              },
              "-orchestrator"
            ]
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaRestApiDeployment00B8E19Ccf7ae3fdfa9ecfc70d8ac33cb637e684": {
      "Type": "AWS::ApiGateway::Deployment",
      "Properties": {
        "RestApiId": {
          "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
        },
        "Description": "Automatically created by the RestApi construct"
      },
      "DependsOn": [
        "PipelineOrchestrationLambdaRestApipipelinestatusPOSTBECDEDF1",
        "PipelineOrchestrationLambdaRestApipipelinestatusE49CAC82",
        "PipelineOrchestrationLambdaRestApiprovisionpipelinePOSTFD9D81F6",
        "PipelineOrchestrationLambdaRestApiprovisionpipelineA402C4B8"
      ],
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W45",
              "reason": "ApiGateway has AccessLogging enabled in AWS::ApiGateway::Stage resource, but cfn_nag checkes for it in AWS::ApiGateway::Deployment resource"
            }
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaRestApiDeploymentStageprodAD71884A": {
      "Type": "AWS::ApiGateway::Stage",
      "Properties": {
        "RestApiId": {
          "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
        },
        "AccessLogSetting": {
          "DestinationArn": {
            "Fn::GetAtt": [
              "PipelineOrchestrationApiAccessLogGroup1BD28E64",
              "Arn"
            ]
          },
          "Format": "{\"requestId\":\"$context.requestId\",\"ip\":\"$context.identity.sourceIp\",\"user\":\"$context.identity.user\",\"caller\":\"$context.identity.caller\",\"requestTime\":\"$context.requestTime\",\"httpMethod\":\"$context.httpMethod\",\"resourcePath\":\"$context.resourcePath\",\"status\":\"$context.status\",\"protocol\":\"$context.protocol\",\"responseLength\":\"$context.responseLength\"}"
        },
        "DeploymentId": {
          "Ref": "PipelineOrchestrationLambdaRestApiDeployment00B8E19Ccf7ae3fdfa9ecfc70d8ac33cb637e684"
        },
        "MethodSettings": [
          {
            "DataTraceEnabled": false,
            "HttpMethod": "*",
            "LoggingLevel": "INFO",
            "ResourcePath": "/*"
          }
        ],
        "StageName": "prod",
        "TracingEnabled": true
      }
    },
    "PipelineOrchestrationLambdaRestApiprovisionpipelineA402C4B8": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaRestApi0420670E",
            "RootResourceId"
          ]
        },
        "PathPart": "provisionpipeline",
        "RestApiId": {
          "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
        }
      }
    },
    "PipelineOrchestrationLambdaRestApiprovisionpipelinePOSTApiPermissionmlopsworkloadorchestratormultiaccountPipelineOrchestrationLambdaRestApiA19BE6E7POSTprovisionpipelineB4B61556": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaFunction7EE5E931",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
              },
              "/",
              {
                "Ref": "PipelineOrchestrationLambdaRestApiDeploymentStageprodAD71884A"
              },
              "/POST/provisionpipeline"
            ]
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaRestApiprovisionpipelinePOSTApiPermissionTestmlopsworkloadorchestratormultiaccountPipelineOrchestrationLambdaRestApiA19BE6E7POSTprovisionpipeline3173CF94": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaFunction7EE5E931",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
              },
              "/test-invoke-stage/POST/provisionpipeline"
            ]
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaRestApiprovisionpipelinePOSTFD9D81F6": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "HttpMethod": "POST",
        "ResourceId": {
          "Ref": "PipelineOrchestrationLambdaRestApiprovisionpipelineA402C4B8"
        },
        "RestApiId": {
          "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
        },
        "AuthorizationType": "AWS_IAM",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:",
                {
                  "Ref": "AWS::Region"
                },
                ":lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "PipelineOrchestrationLambdaFunction7EE5E931",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        }
      }
    },
    "PipelineOrchestrationLambdaRestApipipelinestatusE49CAC82": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "ParentId": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaRestApi0420670E",
            "RootResourceId"
          ]
        },
        "PathPart": "pipelinestatus",
        "RestApiId": {
          "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
        }
      }
    },
    "PipelineOrchestrationLambdaRestApipipelinestatusPOSTApiPermissionmlopsworkloadorchestratormultiaccountPipelineOrchestrationLambdaRestApiA19BE6E7POSTpipelinestatus6583063F": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaFunction7EE5E931",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
              },
              "/",
              {
                "Ref": "PipelineOrchestrationLambdaRestApiDeploymentStageprodAD71884A"
              },
              "/POST/pipelinestatus"
            ]
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaRestApipipelinestatusPOSTApiPermissionTestmlopsworkloadorchestratormultiaccountPipelineOrchestrationLambdaRestApiA19BE6E7POSTpipelinestatus1CA8CFDA": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaFunction7EE5E931",
            "Arn"
          ]
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
              },
              "/test-invoke-stage/POST/pipelinestatus"
            ]
          ]
        }
      }
    },
    "PipelineOrchestrationLambdaRestApipipelinestatusPOSTBECDEDF1": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "HttpMethod": "POST",
        "ResourceId": {
          "Ref": "PipelineOrchestrationLambdaRestApipipelinestatusE49CAC82"
        },
        "RestApiId": {
          "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
        },
        "AuthorizationType": "AWS_IAM",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":apigateway:",
                {
                  "Ref": "AWS::Region"
                },
                ":lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "PipelineOrchestrationLambdaFunction7EE5E931",
                    "Arn"
                  ]
                },
                "/invocations"
              ]
            ]
          }
        }
      }
    },
    "PipelineOrchestrationLambdaRestApiUsagePlan06C27F0E": {
      "Type": "AWS::ApiGateway::UsagePlan",
      "Properties": {
        "ApiStages": [
          {
            "ApiId": {
              "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
            },
            "Stage": {
              "Ref": "PipelineOrchestrationLambdaRestApiDeploymentStageprodAD71884A"
            },
            "Throttle": {}
          }
        ]
      }
    },
    "PipelineOrchestrationLambdaRestApiCloudWatchRole6F4B9723": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "apigateway.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:DescribeLogGroups",
                    "logs:DescribeLogStreams",
                    "logs:PutLogEvents",
                    "logs:GetLogEvents",
                    "logs:FilterLogEvents"
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition"
                        },
                        ":logs:",
                        {
                          "Ref": "AWS::Region"
                        },
                        ":",
                        {
                          "Ref": "AWS::AccountId"
                        },
                        ":*"
                      ]
                    ]
                  }
                }
              ],
              "Version": "2012-10-17"
            },
            "PolicyName": "LambdaRestApiCloudWatchRolePolicy"
          }
        ]
      }
    },
    "PipelineOrchestrationLambdaRestApiAccountB62D7499": {
      "Type": "AWS::ApiGateway::Account",
      "Properties": {
        "CloudWatchRoleArn": {
          "Fn::GetAtt": [
            "PipelineOrchestrationLambdaRestApiCloudWatchRole6F4B9723",
            "Arn"
          ]
        }
      },
      "DependsOn": [
        "PipelineOrchestrationLambdaRestApi0420670E"
      ]
    },
    "AWSMLOpsFrameworkRepositorymlopsworkloadorchestratormultiaccountMLOpsCodeCommitPipeline2658EA4CmainEventRuleF104C992": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "EventPattern": {
          "source": [
            "aws.codecommit"
          ],
          "resources": [
            {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition"
                  },
                  ":codecommit:",
                  {
                    "Ref": "AWS::Region"
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId"
                  },
                  ":",
                  {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          "/",
                          {
                            "Ref": "CodeCommitRepoAddress"
                          }
                        ]
                      }
                    ]
                  }
                ]
              ]
            }
          ],
          "detail-type": [
            "CodeCommit Repository State Change"
          ],
          "detail": {
            "event": [
              "referenceCreated",
              "referenceUpdated"
            ],
            "referenceName": [
              "main"
            ]
          }
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::Join": [
                "",
                [
                  "arn:",
                  {
                    "Ref": "AWS::Partition"
                  },
                  ":codepipeline:",
                  {
                    "Ref": "AWS::Region"
                  },
                  ":",
                  {
                    "Ref": "AWS::AccountId"
                  },
                  ":",
                  {
                    "Ref": "MLOpsCodeCommitPipeline7DA8B5B2"
                  }
                ]
              ]
            },
            "Id": "Target0",
            "RoleArn": {
              "Fn::GetAtt": [
                "MLOpsCodeCommitPipelineEventsRoleBF55A9BA",
                "Arn"
              ]
            }
          }
        ]
      },
      "Condition": "GitAddressProvided"
    },
    "TakeconfigfileRoleD1BE5721": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "codebuild.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Condition": "GitAddressProvided"
    },
    "TakeconfigfileRoleDefaultPolicyC86BF094": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":logs:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":log-group:/aws/codebuild/",
                      {
                        "Ref": "Takeconfigfile940F0BB0"
                      }
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":logs:",
                      {
                        "Ref": "AWS::Region"
                      },
                      ":",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":log-group:/aws/codebuild/",
                      {
                        "Ref": "Takeconfigfile940F0BB0"
                      },
                      ":*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "codebuild:CreateReportGroup",
                "codebuild:CreateReport",
                "codebuild:UpdateReport",
                "codebuild:BatchPutTestCases",
                "codebuild:BatchPutCodeCoverages"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":codebuild:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":report-group/",
                    {
                      "Ref": "Takeconfigfile940F0BB0"
                    },
                    "-*"
                  ]
                ]
              }
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "PipelineOrchestrationLambdaFunction7EE5E931",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "TakeconfigfileRoleDefaultPolicyC86BF094",
        "Roles": [
          {
            "Ref": "TakeconfigfileRoleD1BE5721"
          }
        ]
      },
      "Condition": "GitAddressProvided"
    },
    "Takeconfigfile940F0BB0": {
      "Type": "AWS::CodeBuild::Project",
      "Properties": {
        "Artifacts": {
          "Type": "CODEPIPELINE"
        },
        "Environment": {
          "ComputeType": "BUILD_GENERAL1_SMALL",
          "Image": "aws/codebuild/standard:1.0",
          "ImagePullCredentialsType": "CODEBUILD",
          "PrivilegedMode": false,
          "Type": "LINUX_CONTAINER"
        },
        "ServiceRole": {
          "Fn::GetAtt": [
            "TakeconfigfileRoleD1BE5721",
            "Arn"
          ]
        },
        "Source": {
          "BuildSpec": {
            "Fn::Join": [
              "",
              [
                "{\n  \"version\": \"0.2\",\n  \"phases\": {\n    \"build\": {\n      \"commands\": [\n        \"ls -a\",\n        \"aws lambda invoke --function-name ",
                {
                  "Ref": "PipelineOrchestrationLambdaFunction7EE5E931"
                },
                " --payload fileb://mlops-config.json response.json --invocation-type RequestResponse\"\n      ]\n    }\n  }\n}"
              ]
            ]
          },
          "Type": "CODEPIPELINE"
        },
        "EncryptionKey": "alias/aws/s3"
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "aws:kms"
              }
            }
          ]
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true
        }
      },
      "UpdateReplacePolicy": "Retain",
      "DeletionPolicy": "Retain",
      "Metadata": {
        "cfn_nag": {
          "rules_to_suppress": [
            {
              "id": "W35",
              "reason": "This is a managed bucket generated by CDK for codepipeline."
            },
            {
              "id": "W51",
              "reason": "This is a managed bucket generated by CDK for codepipeline."
            }
          ]
        }
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineRole20F62BCD": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "codepipeline.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineRoleDefaultPolicyF794F4C5": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject*",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "MLOpsCodeCommitPipelineSourceCodeCommitCodePipelineActionRoleA937F768",
                  "Arn"
                ]
              }
            },
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "MLOpsCodeCommitPipelineTakeConfigprovisionpipelineCodePipelineActionRole0EE4D4C6",
                  "Arn"
                ]
              }
            },
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "PipelineOrchestrationLambdaFunction7EE5E931",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "MLOpsCodeCommitPipelineRoleDefaultPolicyF794F4C5",
        "Roles": [
          {
            "Ref": "MLOpsCodeCommitPipelineRole20F62BCD"
          }
        ]
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipeline7DA8B5B2": {
      "Type": "AWS::CodePipeline::Pipeline",
      "Properties": {
        "RoleArn": {
          "Fn::GetAtt": [
            "MLOpsCodeCommitPipelineRole20F62BCD",
            "Arn"
          ]
        },
        "Stages": [
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Source",
                  "Owner": "AWS",
                  "Provider": "CodeCommit",
                  "Version": "1"
                },
                "Configuration": {
                  "RepositoryName": {
                    "Fn::Select": [
                      5,
                      {
                        "Fn::Split": [
                          "/",
                          {
                            "Ref": "CodeCommitRepoAddress"
                          }
                        ]
                      }
                    ]
                  },
                  "BranchName": "main",
                  "PollForSourceChanges": false
                },
                "Name": "CodeCommit",
                "OutputArtifacts": [
                  {
                    "Name": "Artifact_Source_CodeCommit"
                  }
                ],
                "RoleArn": {
                  "Fn::GetAtt": [
                    "MLOpsCodeCommitPipelineSourceCodeCommitCodePipelineActionRoleA937F768",
                    "Arn"
                  ]
                },
                "RunOrder": 1
              }
            ],
            "Name": "Source"
          },
          {
            "Actions": [
              {
                "ActionTypeId": {
                  "Category": "Build",
                  "Owner": "AWS",
                  "Provider": "CodeBuild",
                  "Version": "1"
                },
                "Configuration": {
                  "ProjectName": {
                    "Ref": "Takeconfigfile940F0BB0"
                  }
                },
                "InputArtifacts": [
                  {
                    "Name": "Artifact_Source_CodeCommit"
                  }
                ],
                "Name": "provision_pipeline",
                "RoleArn": {
                  "Fn::GetAtt": [
                    "MLOpsCodeCommitPipelineTakeConfigprovisionpipelineCodePipelineActionRole0EE4D4C6",
                    "Arn"
                  ]
                },
                "RunOrder": 1
              }
            ],
            "Name": "TakeConfig"
          }
        ],
        "ArtifactStore": {
          "Location": {
            "Ref": "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB"
          },
          "Type": "S3"
        }
      },
      "DependsOn": [
        "MLOpsCodeCommitPipelineRoleDefaultPolicyF794F4C5",
        "MLOpsCodeCommitPipelineRole20F62BCD"
      ],
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineSourceCodeCommitCodePipelineActionRoleA937F768": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":iam::",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":root"
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineSourceCodeCommitCodePipelineActionRoleDefaultPolicy9508C70C": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject*",
                "s3:Abort*"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "MLOpsCodeCommitPipelineArtifactsBucketCF13C4BB",
                          "Arn"
                        ]
                      },
                      "/*"
                    ]
                  ]
                }
              ]
            },
            {
              "Action": [
                "codecommit:GetBranch",
                "codecommit:GetCommit",
                "codecommit:UploadArchive",
                "codecommit:GetUploadArchiveStatus",
                "codecommit:CancelUploadArchive"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":codecommit:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":",
                    {
                      "Fn::Select": [
                        5,
                        {
                          "Fn::Split": [
                            "/",
                            {
                              "Ref": "CodeCommitRepoAddress"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "MLOpsCodeCommitPipelineSourceCodeCommitCodePipelineActionRoleDefaultPolicy9508C70C",
        "Roles": [
          {
            "Ref": "MLOpsCodeCommitPipelineSourceCodeCommitCodePipelineActionRoleA937F768"
          }
        ]
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineEventsRoleBF55A9BA": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineEventsRoleDefaultPolicyE691CECE": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "codepipeline:StartPipelineExecution",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:",
                    {
                      "Ref": "AWS::Partition"
                    },
                    ":codepipeline:",
                    {
                      "Ref": "AWS::Region"
                    },
                    ":",
                    {
                      "Ref": "AWS::AccountId"
                    },
                    ":",
                    {
                      "Ref": "MLOpsCodeCommitPipeline7DA8B5B2"
                    }
                  ]
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "MLOpsCodeCommitPipelineEventsRoleDefaultPolicyE691CECE",
        "Roles": [
          {
            "Ref": "MLOpsCodeCommitPipelineEventsRoleBF55A9BA"
          }
        ]
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineTakeConfigprovisionpipelineCodePipelineActionRole0EE4D4C6": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":iam::",
                      {
                        "Ref": "AWS::AccountId"
                      },
                      ":root"
                    ]
                  ]
                }
              }
            }
          ],
          "Version": "2012-10-17"
        }
      },
      "Condition": "GitAddressProvided"
    },
    "MLOpsCodeCommitPipelineTakeConfigprovisionpipelineCodePipelineActionRoleDefaultPolicy897756FB": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "codebuild:BatchGetBuilds",
                "codebuild:StartBuild",
                "codebuild:StopBuild"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "Takeconfigfile940F0BB0",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "MLOpsCodeCommitPipelineTakeConfigprovisionpipelineCodePipelineActionRoleDefaultPolicy897756FB",
        "Roles": [
          {
            "Ref": "MLOpsCodeCommitPipelineTakeConfigprovisionpipelineCodePipelineActionRole0EE4D4C6"
          }
        ]
      },
      "Condition": "GitAddressProvided"
    },
    "SendAnonymousData": {
      "Type": "Custom::AnonymousData",
      "Properties": {
        "ServiceToken": {
          "Fn::GetAtt": [
            "SolutionHelperC369AAA8",
            "Arn"
          ]
        },
        "Resource": "AnonymousMetric",
        "UUID": {
          "Fn::GetAtt": [
            "CreateUniqueID",
            "UUID"
          ]
        },
        "bucketSelected": {
          "Fn::If": [
            "S3BucketProvided",
            "True",
            "False"
          ]
        },
        "gitSelected": {
          "Fn::If": [
            "GitAddressProvided",
            "True",
            "False"
          ]
        },
        "Region": {
          "Ref": "AWS::Region"
        },
        "IsMultiAccount": "True",
        "IsDelegatedAccount": {
          "Ref": "DelegatedAdminAccount"
        },
        "UseModelRegistry": {
          "Ref": "UseModelRegistry"
        },
        "SolutionId": "SO0136",
        "Version": "v1.5.0"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Condition": "AnonymousDatatoAWS"
    }
  },
  "Outputs": {
    "PipelineOrchestrationLambdaRestApiEndpoint9B628338": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "PipelineOrchestrationLambdaRestApi0420670E"
            },
            ".execute-api.",
            {
              "Ref": "AWS::Region"
            },
            ".",
            {
              "Ref": "AWS::URLSuffix"
            },
            "/",
            {
              "Ref": "PipelineOrchestrationLambdaRestApiDeploymentStageprodAD71884A"
            },
            "/"
          ]
        ]
      }
    },
    "BlueprintsBucket": {
      "Description": "S3 Bucket to upload MLOps Framework Blueprints",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://s3.console.aws.amazon.com/s3/buckets/",
            {
              "Ref": "blueprintrepositorydd714561948e4cda9f5df5462a5936bc5B356C6C"
            }
          ]
        ]
      }
    },
    "AssetsBucket": {
      "Description": "S3 Bucket to upload model artifact",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://s3.console.aws.amazon.com/s3/buckets/",
            {
              "Fn::If": [
                "S3BucketProvided",
                {
                  "Ref": "ExistingS3Bucket"
                },
                {
                  "Ref": "pipelineassets28ca6efdaf6b4620b533d07850906d2d9E17F8D7"
                }
              ]
            }
          ]
        ]
      }
    },
    "ECRRepoName": {
      "Description": "Amazon ECR repository's name",
      "Value": {
        "Fn::If": [
          "ECRProvided",
          {
            "Ref": "ExistingECRRepo"
          },
          {
            "Ref": "ECRRepoC36DC9E6"
          }
        ]
      }
    },
    "ECRRepoArn": {
      "Description": "Amazon ECR repository's arn",
      "Value": {
        "Fn::If": [
          "ECRProvided",
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":ecr:",
                {
                  "Ref": "AWS::Region"
                },
                ":",
                {
                  "Ref": "AWS::AccountId"
                },
                ":repository/",
                {
                  "Ref": "ExistingECRRepo"
                }
              ]
            ]
          },
          {
            "Fn::GetAtt": [
              "ECRRepoC36DC9E6",
              "Arn"
            ]
          }
        ]
      }
    },
    "ModelRegistryArn": {
      "Description": "SageMaker model package group arn",
      "Value": {
        "Fn::If": [
          "CreateModelRegistryCondition",
          {
            "Fn::GetAtt": [
              "SageMakerModelRegistry",
              "ModelPackageGroupArn"
            ]
          },
          "[No Model Package Group was created]"
        ]
      }
    }
  },
  "Mappings": {
    "AnonymousData": {
      "SendAnonymousData": {
        "Data": "Yes"
      }
    }
  }
}